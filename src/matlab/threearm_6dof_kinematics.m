a = [-600; 0; 0];
Ra = eye(3);
q1 = [-pi/6; pi/3; -pi/6; 0; -pi/6; pi/6];
q2 = [pi/6; -pi/3; pi/6; 0; pi/6; -pi/6];
q3 = [pi/2; pi/3; -pi/6; 0; -pi/6; -pi/2];
% q1 = [0; 0; 0; 0; 0; 0];
% q2 = [0; 0; 0; 0; 0; 0];

q = [q1; q2; q3];
% arm_base_x = 218.13;
% arm_base_y = 095.525;
% arm_base_z = 240.12;
arm_base_x = 457.2/2;
arm_base_y = 100;
arm_base_z = 100;

ab1 = [arm_base_x; arm_base_y; -arm_base_z];
ab2 = [arm_base_x; -arm_base_y; -arm_base_z];
ab3 = [arm_base_x; 0; sqrt(arm_base_y^2 + arm_base_z^2)];

b1 = a + Ra*ab1;
b2 = a + Ra*ab2;
b3 = a + Ra*ab3;

frames1 = forkin_6dof(q1, b1, Ra);
frames2 = forkin_6dof(q2, b2, Ra);
frames3 = forkin_6dof(q3, b3, Ra);

E1 = frames1(1:3, 4, 6)
E2 = frames2(1:3, 4, 6)
E3 = frames3(1:3, 4, 6)

%%
figure(1)
clf
set(gcf,'Position', get(0, 'ScreenSize'));
view(135, 45)
axis equal
axis([-1100 500 -500 500 -500 500])
draw_auv(a, Ra)
draw_arm_6dof(frames1, b1, 'r')
draw_arm_6dof(frames2, b2, 'g')
draw_arm_6dof(frames3, b3, 'b')

%% Full 6 DoF (12x6) Jacobian eigenvector analysis
clc
[J, Jx, Jq] = jacobian_threearm_6dof(Ra, q);
K = 10*J'*J;
[V,D] = eig(K);

v1 = V(:,1)
F1 = v1*10
X1 = inv(K)*F1

v2 = V(:,2)
F2 = v2*10
X2 = inv(K)*F2

v3 = V(:,3)
F3 = v3*10
X3 = inv(K)*F3

v4 = V(:,4)
F4 = v4*10
X4 = inv(K)*F4

v5 = V(:,5)
F5 = v5*10
X5 = inv(K)*F5

v6 = V(:,6)
F6 = v6*10
X6 = inv(K)*F6


%%
clc
s1 = [-0.2286; 0; 0; 0; 0; 0];
s2 = s1;
s3 = s1;
s4 = s1;
s5 = s1;
s6 = s1;

f1 = [-0.229284383825;...
1.85627539971e-08;...
7.40296566047e-05;...
5.03522984589e-07;...
0.000594027344503;...
1.78157136039e-07];

f2 = [-0.227854187742;...
-4.81269188856e-07;...
0.00327712431805;...
9.86911199985e-07;...
0.0265309259822;...
9.883210083e-07];

f3 = [-0.22877893073;...
8.08334884907e-07;...
-0.010882244093;...
-1.15197247434e-06;...
-0.0617452208033;...
-2.3642625174e-06];

f4 = [-0.228149362464;...
-0.00790870582962;...
0.00020971169553;...
0.00875389802972;...
0.00364718001034;...
0.0409012041939];

f5 = [-0.227567288501;...
0.0156958987022;...
-0.000256595259974;...
-0.0344553874544;...
0.00654729380507;...
-0.0609359136529];

f6 = [-0.22742521664;...
0.000447998582732;...
0.000973355868861;...
-0.108001675689;...
0.00119478978104;...
0.0160246919654];

d1 = f1 - s1
e1 = d1 - X1
d1_norm = d1/norm(d1)
e1_norm = (d1 - X1)/norm(X1)*100

d2 = f2 - s2
e2 = d2 - X2
d2_norm = d2/norm(d2)

d3 = f3 - s3
e3 = d3 - X3
d3_norm = d3/norm(d3)

d4 = f4 - s4
e4 = d4 - X4
d4_norm = d4/norm(d4)

d5 = f5 - s5
e5 = d5 - X5
d5_norm = d5/norm(d5)

d6 = f6 - s6
e6 = d6 - X6
d6_norm = d6/norm(d6)


%% Primary axis displacements
clc
s1 = [-0.2286; 0; 0; 0; 0; 0];
s2 = s1;
s3 = s1;

f1 = [-0.228525374602;...
-4.5220885856e-09;...
2.02421589679e-05;...
-4.22607121161e-08;...
0.000118999844718;...
-1.16605631415e-08];

f2 = [-0.228598817489;...
0.00052980908398;...
-9.00927511801e-07;...
-0.000504204421867;...
7.18103327836e-07;...
-0.00156502453402];

f3 = [-0.228579010583;...
-3.23205668328e-09;...
0.000350200081504;...
5.20266569547e-08;...
0.00103282577668;...
1.00933155799e-08];

d1 = f1 - s1

d2 = f2 - s2

d3 = f3 - s3



